# Скрипт конвертации BIK-видео для игр Command & Conquer

Этот пакетный файл предназначен для автоматической конвертации видеофайлов из формата MP4 в формат BIK с добавлением звуковых дорожек из WAV-файлов для различных версий игры Command & Conquer.

## Поддерживаемые игры

- **Red Alert 1 (RA1)** - видео с поддержкой HD и стандартного формата
- **Red Alert 2 (RA2)** - видео с поддержкой HD и стандартного формата  
- **Red Alert 2 Yuri's Revenge (RA2YR)** - видео с поддержкой HD и стандартного формата

## Использование

```bash
Cross_Converted_BIK.bat [-RA1] [-RA2] [-RA2YR]
```

Если параметры не указаны, обрабатываются все игры.   
Примеры:

- ```Cross_Converted_BIK.bat -RA1``` - обработать только Red Alert 1
- ```Cross_Converted_BIK.bat -RA2 -RA2YR``` - обработать Red Alert 2 и Yuri's Revenge

Для проверки работы использовал следующие материалы:
- RA1 [WAV_Sound_RA1](https://disk.yandex.ru/d/fypGSbfMwDs8uQ)
- RA1 [Clean_MP4_RA1](https://disk.yandex.ru/d/jTlcTHwJjgLhWg)
- RA2/RA2YR [WAV_Sound_RA2_RA2YR](https://disk.yandex.ru/d/v5S_kkOyPR6YMA)
- RA2/RA2YR [Clean_MP4_RA2_RA2YR](https://disk.yandex.ru/d/2c-p-ID_-__Jog)
- RA2/RA2YR [Clean_BIK_RA2_RA2YR](https://disk.yandex.ru/d/xmjS5EqcHf8PRQ)

P.S.: 
- Катсцены RA1 будут преобразованы в формат Bink v1 для использования в модах на движке RA2/RA2YR.
- Озвучки RA1 - Original (English), R.G.MVO, VHS
- Озвучки RA2 - Original (English), 7wolf, City [Dyadyushka Risyotch], Fargus, Russian project, Triada, XXI Vek [8 Bit]
- Озвучки RA2YR - Original (English), 7wolf, City [Dyadyushka Risyotch], Fargus,  Triada

### Внимание! Кодирование происходит за счет CPU и очень сильно его нагружает. На весь процесс из 3 игр у меня ушло около 2 дней  (при AMD Ryzen 9 8945HS).

## Структура каталогов

Для корректной работы скрипта необходимо создать следующую структуру каталогов:

```
.
├── Cross_Converted_BIK.bat
├── Radtools_New/
│      └── radvideo64.exe
├── Radtools_Old/
│      └── BinkMix.exe
├── Clean_MP4/
│   ├── RA1/
│   │   ├── HD/
│   │   │   ├── noWAV/          # Видео без звука
│   │   │   └── WAV/            # Видео со звуком
│   │   └── noHD/               # Видео стандартного формата
│   ├── RA2/
│   └── RA2YR/
├── WAV_Sound/
│   ├── RA1/
│   │   └── GroupName/          # Группы языков/озвучки
│   ├── RA2/
│   │   └── GroupName/
│   └── RA2YR/
│       └── GroupName/
├── Clean_BIK/                  # Оригинальные BIK-файлы
│   ├── RA2/
│   └── RA2YR/
├── Final_BIK_RA1/              # Результаты для RA1
├── Final_BIK_RA2/              # Результаты для RA2
└── Final_BIK_RA2YR/            # Результаты для RA2YR 
```

### Описание каталогов

* **`Clean_MP4/`**

  * Исходные видеофайлы в формате MP4, организованные по играм. 
  * Для RA1 предусмотрены подкатегории: HD (высокое качество) и noHD (стандартное качество). Т.к. основные катсцены имеют низкое качество.

* **`WAV_Sound/`**

  * Звуковые дорожки в формате WAV, организованные по играм и группам.
  * Группы определяют языковые версии или типы озвучки.
  * Имена файлов должны совпадать с соответствующими MP4-файлами.

* **`Clean_BIK/`** 

  * Оригинальные BIK-файлы для RA2 и RA2YR (касцены верхнего правого угла игры, там где радар).
  * Используются для добавления звука без перекодировки виде.

* **`Radtools_New/`** и **`Radtools_Old/`**

  * Утилиты Rad Game Tools для работы с BIK-форматом.
  * `radvideo64.exe` - конвертация видео
  * `BinkMix.exe` - смешивание видео и аудио

## Поддерживаемые разрешения

Для каждой игры создаются видео в следующих разрешениях:

* 600p (800×600 / 1024×600)
* 720p (960×720 / 1280×720)
* 768p (1024×768 / 1366×768)
* 900p (1200×900 / 1600×900)
* 1080p (1400×1080 / 1920×1080)
* noformat (140×110) - для RA2 и RA2YR, (1024×564) - для RA1


## Принцип работы

Скрипт выполняет следующие шаги:
1. Проверка зависимостей: Проверяет наличие инструментов и исходных каталогов.
2. Создание структуры папок: Автоматически создает папки для результатов.
3. Обработка видео: Конвертирует MP4 в BIK с разными разрешениями и битрейтами.
4. Добавление звука: Смешивает видео с соответствующими WAV-дорожками.
5. Логирование: Весь процесс записывается в файл conversion_log.txt.

## Особенности обработки для разных игр

### Red Alert 1 (RA1)

- HD/noWAV - видео высокого качества без звука
- HD/WAV - видео высокого качества со звуком
- noHD - видео стандартного качества со звуком

### Red Alert 2 и Yuri's Revenge (RA2/RA2YR)
- Обработка MP4-файлов с созданием HD-версий
- Обработка оригинальных BIK-файлов (если доступны)
- Поддержка различных языковых групп

## Благодарности

* создателям [RADTOOLS](https://www.radgametools.com/)

* создателям [ffmpeg](https://rwijnsma.home.xs4all.nl/files/ffmpeg/) (универсальной модификации под любые windows)

* [DarK600](https://forums.nexusmods.com/profile/41423505-dark600dionis/) (за предоставленные Fullscreen cutscenes - AI-Upscaled - boosted to 30 FPS от RA2YR и RA2)