# Скрипт конвертации BIK-видео

Этот пакетный файл предназначен для автоматической конвертации видеофайлов из формата MP4 в формат BIK, с добавлением звуковых дорожек из существующих BIK-файлов.

Файлы, которые могут быть изменены или сгенерированы в процессе работы скрипта, а также исходные видео- и аудиофайлы добавлены в `.gitignore`, чтобы избежать их попадания в систему контроля версий.

## Структура каталогов

Для корректной работы скрипта необходимо создать следующую структуру каталогов:

```
.  
├── Converted_BIK.bat  
├── FFMPEG.exe  
├── Radtools_New/  
│      └── radvideo64.exe  
├── Radtools_Old/  
│      └── BinkMix.exe  
├── Clean/  
│      └── example.mp4  
└── Original_BIK_Sound/  
       └── GroupName/  
               └── example.bik  
```

### Описание каталогов

* **`Clean/`**

  * В эту папку следует помещать **исходные видеофайлы в формате MP4**. Скрипт будет брать видео отсюда для конвертации.

* **`Original_BIK_Sound/`**

  * Эта папка содержит **каталоги-группы**, которые определяют, к какому видео какой звук принадлежит.

  * Внутри каждой группы (`GroupName/`) должны находиться **оригинальные BIK-файлы**, из которых будет извлечена звуковая дорожка.

  * **Важно:** Имя файла `.mp4` в папке `Clean/` должно совпадать с именем файла `.bik` в соответствующей папке-группе.

* **`Radtools_New/`** и **`Radtools_Old/`**

  * Эти папки содержат необходимые утилиты **Rad Game Tools**.

  * `Radtools_New/radvideo64.exe` — используется для конвертации видео.

  * `Radtools_Old/BinkMix.exe` — используется для смешивания видео и аудио.

* **`FFMPEG.exe`**

  * Исполняемый файл FFmpeg, который необходим для опциональной конвертации видео из H.265 в H.264.

## Принцип работы

Скрипт выполняет следующие шаги:

1. **Проверка зависимостей:** Проверяет наличие всех необходимых файлов-инструментов и исходных каталогов.

2. **Конвертация MP4:** Если при запуске скрипта указан параметр `-h264`, то все MP4-файлы из папки `Clean/` конвертируются в формат H.264 и временно сохраняются в папку `Temp_MP4/`.

3. **Обработка файлов:** Скрипт проходит по всем MP4-файлам (либо из `Clean/`, либо из `Temp_MP4/`) и ищет соответствующую папку-группу в `Original_BIK_Sound/`.

4. **Генерация BIK-файлов:** Для каждого файла создаются 5 вариантов в разных разрешениях (`600p`, `720p`, `768p`, `900p`, `1080p`) в папке `Final_BIK/`.

5. **Добавление звука:** Звуковая дорожка из соответствующего оригинального BIK-файла (из `Original_BIK_Sound/`) добавляется к каждому сгенерированному видео.

## Использование

Чтобы запустить скрипт, просто дважды щелкните по `Converted_BIK.bat`.

Для конвертации видео из формата H.265 в H.264 перед началом работы, запустите скрипт с параметром `-h264`:

```bash
Converted_BIK.bat -h264
```


> **Примечание:** В процессе работы скрипт будет создавать временные файлы и папки. Все результаты конвертации будут сохранены в каталоге `Final_BIK/`.

Для проверки работы использовал [Fullscreen cutscenes - AI-Upscaled - boosted to 30 FPS от RA2YR](https://disk.yandex.ru/d/RSHAe2bjTJMmFQ)

## Благодарности

* создателям [RADTOOLS](https://www.radgametools.com/)

* создателям [ffmpeg](https://rwijnsma.home.xs4all.nl/files/ffmpeg/) (универсальной модификации под любые windows)

* [DarK600](https://forums.nexusmods.com/profile/41423505-dark600dionis/) (за предоставленные Fullscreen cutscenes - AI-Upscaled - boosted to 30 FPS от RA2YR)